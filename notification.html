<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Notification Test</title>
    <meta name="viewport" content="width=device-width">
</head>

<body>
    <h1>Notification Test</h1>

    <button id="permission">Set permission</button>

    <button id="test">Show Notification</button>

    <ul id="logger"></ul>

    <p>References: <a href="http://www.w3.org/TR/notifications/">W3C Working Draft</a>, <a href="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification">chromium.org</a> and <a href="http://www.html5rocks.com/en/tutorials/notifications/quick/">HTML5 Rocks</a></p>

    <script>
    (function (win, doc, nav) {
        var Notify = win.Notification ? win.Notification : win.webkitNotifications ? win.webkitNotifications : nav.mozNotification ? nav.mozNotification : false,
            notificationOld = ((win.webkitNotifications || nav.mozNotification) && !win.Notification) || false,
            permission = doc.getElementById('permission'),
            test = doc.getElementById('test'),
            logger = doc.getElementById('logger'),
            check,
            logs = '';

        function log (msg) {
            logs += '<li>' + msg + '</li>';
            logger.innerHTML = logs;
        }


        if (Notify) {
            check = Notify.permission ? Notify.permission : notificationOld ? Notify.checkPermission() : 'i have no method to check for permission :-(';
            log('Yeah, your browser seems to support Notification');
            permission.addEventListener('click', function () {
                if (check == 0 || "default"  || "webkitisthenewie6") {
                    log('Permission before requesting is: ' + check);
                    Notify.requestPermission(log('Permission after requesting is: ' + check));   
                } else {
                    log('permission already set' + check);
                }
                  
            })

            test.addEventListener('click', function () {
                if (check == 1 || "granted" || "webkitisthenewie6") {
                    if (notificationOld) {
                        Notify = Notify.createNotification(
                            "icon.png",
                            "Title",
                            "Text"
                        );
                        Notify.show();
                    } else {
                        Notify = new Notify("Title", {
                            iconUrl: "icon.png",
                            body: "Text",
                            tag: "optional"
                        });
                    }
                    Notify.ondisplay = function () {log('Notification visible')};
                    Notify.onclose = function () {log('Notification closed')};
                    Notify.onerror = function () {log('An error occured')};
                    Notify.onclick = function () {log('Click on Notification')};
                    
                } else if (check == 0 || "default"  || "webkitisthenewie6") {
                    log('Permission before requesting is ' + Notify.checkPermission());
                    Notify.requestPermission();
                    log('Permission after requesting is ' + Notify.checkPermission());
                } else {
                    log('Permission denied')
                    alert(permissions.granted);
                }
                
            });     
        } else {
            log('Oh no, your browser seems NOT to support Notification');
        }
        
    }(window, document, navigator));
    </script>
</body>
</html>
